# FeelApp REST API

RESTfull API provides access to the following resources:

- Applications
- Tips

## API endpoints

### Partner resource

All requests to do tips must be signed with partner token.
Partner token is a string that must be obtained via the following API.

#### Get partner token

``GET /api/v1/partner/<partner-key>/token``

##### Parameters

URL parameter:
- ``<partner-key>`` is a secret key generated by FeelApp admin via
  admin interface. Please contact us to obtain the key.

##### Response (JSON)

    {
      partner_token: 'partner-token'
    }

The token is valid for 24 hours. Please note that each subsequent request can
return a different partner token. Multiple tokens obtained this way can be
valid at the same time as long as they are not expired.

For security reason, to avoid partner key exposure we recommend to
perform such requests from server side only, not from the client side.

### User resource

Represents external users (users registered on partners' websites)

#### Get user status

``GET /api/v1/user/<user-id>/status?partner_token=<partner-token>``

##### Parameters

URL parameter
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request
- ``user-id`` - performer user id on the partner website, string, up to
    1000 chars long.

##### Response (JSON)

{
  user_id: 'user-id',
  authenticated: true | false,
  online: true | false
  devices: <device-list>,
  rooms: <room-list>
}

- ``user_id`` - performer user id, same as provided in request
- ``authenticated`` - ``true`` if user is known to FeelApp
- ``online`` - ``true`` if user is known and has the performer app running
- ``devices`` is a list of devices which are connected to the app
    (e.g. ``['PEARL', 'ONYX']``)
- ``rooms`` is a list of rooms user currently joined. Each room contains
    following fields:
    - room_id - unique room id
    - read - flag indicating if user can read from this room
    - write - flag indicating if user can write to this room
    Note: currently user cannot join more than one room. You have to kick
    the user out of the old room in order to join them to another one.

#### Request user authorization

``GET /api/v1/user/<user-id>/auth?partner_token=<partner-token>``

##### Parameters

URL parameter
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request
- ``user-id`` - performer user id on the partner website, string, up to
    1000 chars long.

##### Response (JSON)

{
  auth_token: 'auth-token'
}

This request returns auth token which should be displayed as the QR code.

##### Possible errors

- ``401 NOT AUTHORIZED`` - partner token is invalid.

#### Send a tip to the user

``POST /api/v1/user/<user-id>/tip?partner_token=<partner-token>``

##### Parameters

URL parameters:
- ``user-id`` - performer user id on the partner website
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request

POST parameters:
- ``sender`` - username of the person who sent the tip, string (e.g. ``John Doe``)
- ``amount`` - tip amount, string (e.g. ``10 coins``)
- ``duration`` - tip (vibration) duration in seconds, floating point number (e.g. ``2.5``)
- ``strength`` - tip (vibration) strength in percents, integer (e.g. ``50``)

##### Possible errors

- ``404 NOT FOUND`` - user is offline or is not known to the FeelApp system.
    You should use ``/api/v1/user/<user-id>/status`` to see the reason
    why the tip cannot be sent.
- ``401 NOT AUTHORIZED`` - partner token is invalid.

#### Getting realtime resource

``GET /api/v1/user/<user-id>/realtime?partner_token=<partner-token>``

##### Parameters

URL parameters:
- ``user-id`` - performer user id on the partner website
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request

##### Response (JSON)

{
  realtime_resource_id: 'realtime-resource-id'
}

This request returns the realtime resource id which should be used with
FellMe JavaScript SDK.

##### ERRORS

- ``404 NOT FOUND`` - user is not known to the FeelApp system.
- ``401 NOT AUTHORIZED`` - partner token is invalid.


### Room resource

#### Add user to the room

``POST /api/v1/room/<room-id>/users?partner_token=<partner-token>``

##### NOTE

User cannot be added to more than one room at the same time. If the user
has already joined another room, this call will return error.

##### Parameters

URL parameters:
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request
- ``room-id`` - room id to add user to. If room does not exist, it will
                be created.

POST parameters:
- ``user`` - user id on the partner website
- ``read`` - 0 or 1, indicating if user can read data from the room
- ``write`` - 0 or 1, indicating if user can write data to the room

##### Response (JSON)

Returns ``{}`` in case of success

##### ERRORS

- ``404 NOT FOUND`` - user is not known to the FeelApp system.
- ``401 NOT AUTHORIZED`` - partner token is invalid.
- ``409 CONFLICT`` - user is already in other room. Please remove user from
                     that room first.

#### Delete user from the room

``DELETE /api/v1/room/<room-id>/users/<user-id>?partner_token=<partner-token>``

##### Parameters

URL parameters:
- ``partner_token`` - partner token previously returned by
    ``/api/v1/partner/<partner-key>/token`` request
- ``user-id`` - user id on the partner website

##### Response (JSON)

Returns ``{}`` in case of success

##### ERRORS

- ``404 NOT FOUND`` - user is not known to the FeelApp system or not in the room.
- ``401 NOT AUTHORIZED`` - partner token is invalid.
